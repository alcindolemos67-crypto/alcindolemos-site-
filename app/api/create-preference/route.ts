import { NextResponse } from 'next/server';
export async function POST(req: Request){try{const body=await req.json();const {sku,title,unit_price}=body||{};if(!sku||!title||!unit_price)return NextResponse.json({error:'Dados inválidos'},{status:400});const MP_TOKEN=process.env.MP_ACCESS_TOKEN as string;const SITE_URL=process.env.SITE_URL as string;const CURRENCY=process.env.CURRENCY||'BRL';if(!MP_TOKEN||!SITE_URL)return NextResponse.json({error:'Config ausente'},{status:500});const mercadopago=(await import('mercadopago')).default;mercadopago.configure({access_token:MP_TOKEN});const pref:any={items:[{id:sku,title,quantity:1,unit_price:Number(unit_price),currency_id:CURRENCY}],back_urls:{success:`${SITE_URL}/success`,failure:`${SITE_URL}/cancel`,pending:`${SITE_URL}/success`},auto_return:'approved',statement_descriptor:'ALCINDOLEMOS'};const r=await mercadopago.preferences.create(pref);return NextResponse.json({id:r.body.id,init_point:r.body.init_point});}catch(e:any){return NextResponse.json({error:e.message||'Falha ao criar preferência'},{status:500});}}